# Description: add a gconf key (/desktop/gnome/interface/hide_decorator_tooltip)
# to disable tooltip in decorator bar. If key not present, show the tooltip.
# Origin: Ubuntu
# Bug: https://bugzilla.gnome.org/show_bug.cgi?id=609563
# Bug-Ubuntu: https://bugs.launchpad.net/ubuntu/+source/mutter/+bug/519856

Index: mutter-2.91.2/src/core/prefs.c
===================================================================
--- mutter-2.91.2.orig/src/core/prefs.c	2010-11-26 11:26:45.000000000 +1100
+++ mutter-2.91.2/src/core/prefs.c	2010-11-26 11:27:10.752551000 +1100
@@ -105,6 +105,7 @@
 static gboolean compositing_manager = FALSE;
 static gboolean resize_with_right_button = FALSE;
 static gboolean side_by_side_tiling = FALSE;
+static gboolean hide_decorator_tooltip = FALSE;
 static gboolean force_fullscreen = TRUE;
 
 static MetaVisualBellType visual_bell_type = META_VISUAL_BELL_FULLSCREEN_FLASH;
@@ -439,6 +440,11 @@
       &no_tab_popup,
       FALSE,
     },
+    { "/desktop/gnome/interface/hide_decorator_tooltip",
+      META_PREF_HIDE_DECORATOR_TOOLTIP,
+      &hide_decorator_tooltip,
+      FALSE,
+    },
     { NULL, 0, NULL, FALSE },
   };
 
@@ -1518,6 +1524,12 @@
   return raise_on_click;
 }
 
+gboolean
+meta_prefs_get_hide_decorator_tooltip (void)
+{
+  return hide_decorator_tooltip;
+}
+
 const char*
 meta_prefs_get_theme (void)
 {
@@ -2022,6 +2034,9 @@
 
     case META_PREF_NO_TAB_POPUP:
       return "NO_TAB_POPUP";
+
+    case META_PREF_HIDE_DECORATOR_TOOLTIP:
+      return "HIDE_DECORATOR_TOOLTIP";
     }
 
   return "(unknown)";
Index: mutter-2.91.2/src/include/prefs.h
===================================================================
--- mutter-2.91.2.orig/src/include/prefs.h	2010-10-21 07:15:21.000000000 +1100
+++ mutter-2.91.2/src/include/prefs.h	2010-11-26 11:26:54.632551001 +1100
@@ -64,7 +64,8 @@
   META_PREF_FORCE_FULLSCREEN,
   META_PREF_CLUTTER_PLUGINS,
   META_PREF_LIVE_HIDDEN_WINDOWS,
-  META_PREF_NO_TAB_POPUP
+  META_PREF_NO_TAB_POPUP,
+  META_PREF_HIDE_DECORATOR_TOOLTIP
 } MetaPreference;
 
 typedef void (* MetaPrefsChangedFunc) (MetaPreference pref,
@@ -89,6 +90,7 @@
 MetaFocusNewWindows         meta_prefs_get_focus_new_windows  (void);
 gboolean                    meta_prefs_get_attach_modal_dialogs (void);
 gboolean                    meta_prefs_get_raise_on_click     (void);
+gboolean                    meta_prefs_get_hide_decorator_tooltip (void);
 const char*                 meta_prefs_get_theme              (void);
 /* returns NULL if GTK default should be used */
 const PangoFontDescription* meta_prefs_get_titlebar_font      (void);
Index: mutter-2.91.2/src/ui/frames.c
===================================================================
--- mutter-2.91.2.orig/src/ui/frames.c	2010-11-04 10:09:02.000000000 +1100
+++ mutter-2.91.2/src/ui/frames.c	2010-11-26 11:27:38.692551000 +1100
@@ -1084,6 +1084,9 @@
   if (frame == NULL)
     return;
 
+  if (meta_prefs_get_hide_decorator_tooltip ())
+    return;
+
   display = GDK_DISPLAY_XDISPLAY (gdk_display_get_default ());
 
   XQueryPointer (display,
