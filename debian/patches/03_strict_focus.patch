Description: Strict focus mode (/apps/metacity/general/focus_mode = strict)
Author: LaMont Jones <lamont at debian.org>

Index: mutter-2.31.2/src/core/display.c
===================================================================
--- mutter-2.31.2.orig/src/core/display.c	2010-05-25 19:24:30.000000000 +0200
+++ mutter-2.31.2/src/core/display.c	2010-06-23 21:58:39.857704000 +0200
@@ -2009,6 +2009,7 @@
         {
           switch (meta_prefs_get_focus_mode ())
             {
+            case META_FOCUS_MODE_STRICT:
             case META_FOCUS_MODE_SLOPPY:
             case META_FOCUS_MODE_MOUSE:
               display->mouse_mode = TRUE;
Index: mutter-2.31.2/src/core/prefs.c
===================================================================
--- mutter-2.31.2.orig/src/core/prefs.c	2010-04-18 02:44:38.000000000 +0200
+++ mutter-2.31.2/src/core/prefs.c	2010-06-23 21:58:39.857704000 +0200
@@ -197,6 +197,7 @@
     { META_FOCUS_MODE_CLICK,  "click" },
     { META_FOCUS_MODE_SLOPPY, "sloppy" },
     { META_FOCUS_MODE_MOUSE,  "mouse" },
+    { META_FOCUS_MODE_STRICT, "strict" },
     { 0, NULL },
   };
 
Index: mutter-2.31.2/src/core/window.c
===================================================================
--- mutter-2.31.2.orig/src/core/window.c	2010-05-21 13:09:21.000000000 +0200
+++ mutter-2.31.2/src/core/window.c	2010-06-23 21:59:56.961704001 +0200
@@ -2697,7 +2697,7 @@
   if (window->showing_for_first_time)
     {
       window->showing_for_first_time = FALSE;
-      if (takes_focus_on_map)
+      if (takes_focus_on_map && meta_prefs_get_focus_mode () != META_FOCUS_MODE_STRICT)
         {
           guint32     timestamp;
 
Index: mutter-2.31.2/src/core/workspace.c
===================================================================
--- mutter-2.31.2.orig/src/core/workspace.c	2010-04-18 02:44:38.000000000 +0200
+++ mutter-2.31.2/src/core/workspace.c	2010-06-23 21:58:39.869704000 +0200
@@ -1256,7 +1256,8 @@
         }
       else if (meta_prefs_get_focus_mode () == META_FOCUS_MODE_SLOPPY)
         focus_ancestor_or_mru_window (workspace, not_this_one, timestamp);
-      else if (meta_prefs_get_focus_mode () == META_FOCUS_MODE_MOUSE)
+      else if (meta_prefs_get_focus_mode () == META_FOCUS_MODE_MOUSE ||
+               meta_prefs_get_focus_mode () == META_FOCUS_MODE_STRICT)
         {
           meta_topic (META_DEBUG_FOCUS,
                       "Setting focus to no_focus_window, since no valid "
Index: mutter-2.31.2/src/include/common.h
===================================================================
--- mutter-2.31.2.orig/src/include/common.h	2010-04-26 23:00:19.000000000 +0200
+++ mutter-2.31.2/src/include/common.h	2010-06-23 21:58:39.873704000 +0200
@@ -165,7 +165,8 @@
 {
   META_FOCUS_MODE_CLICK,
   META_FOCUS_MODE_SLOPPY,
-  META_FOCUS_MODE_MOUSE
+  META_FOCUS_MODE_MOUSE,
+  META_FOCUS_MODE_STRICT
 } MetaFocusMode;
 
 typedef enum
